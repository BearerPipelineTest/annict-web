<% title = t "head.title.tracks.show" %>
<% set_meta_tags(title: title, reverse: true, prefix: false) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 py-3">
      <%= render Sidebars::TrackSidebarComponent.new(library_entry_entities: @library_entry_entities) %>
    </div>

    <div class="col-md-9">
      <table
        class="table table-hover"
        data-controller="bulk-track-episodes"
      >
        <tbody>
          <% @slot_entities.each do |slot_entity| %>
            <%= render TrackableEpisodeTableRowComponent.new(episode_entity: slot_entity.episode) do %>
              <div class="c-slot-episode row">
                <div class="col-auto pr-0">
                  <%= link_to anime_path(anime_id: slot_entity.anime.database_id) do %>
                    <%= render WorkImageComponent.new(
                        image_url_1x: slot_entity.anime.image_url_1x,
                        image_url_2x: slot_entity.anime.image_url_2x,
                        alt: slot_entity.anime.local_title
                    ) %>
                  <% end %>
                </div>

                <div class="col">
                  <div>
                    <% tv_time = Annict::TvTime.new(time_zone: current_user.time_zone) %>
                    <% if (tv_time.beginning_of_today - 1.day + 5.hours) < slot_entity.started_at && slot_entity.started_at < (tv_time.beginning_of_today.end_of_day - 1.day + 5.hours) %>
                      <small class="badge badge-success">
                        <%= t "noun.yesterday" %>
                      </small>
                    <% elsif (tv_time.beginning_of_today + 5.hours) < slot_entity.started_at && slot_entity.started_at < (tv_time.beginning_of_today.end_of_day + 5.hours) %>
                      <small class="badge badge-danger">
                        <%= t "noun.today" %>
                      </small>
                    <% elsif (tv_time.beginning_of_today + 1.day + 5.hours) < slot_entity.started_at && slot_entity.started_at < (tv_time.beginning_of_today.end_of_day + 1.day + 5.hours) %>
                      <small class="badge badge-info">
                        <%= t "noun.tomorrow" %>
                      </small>
                    <% end %>

                    <small class="badge badge-light small">
                      <%= slot_entity.channel.name %>
                    </small>
                  </div>

                  <div class="small">
                    <%= display_time(slot_entity.started_at) %>
                  </div>

                  <div>
                    <div class="font-weight-bold small">
                      <%= link_to slot_entity.anime.local_title, anime_path(anime_id: slot_entity.anime.database_id), class: "u-text-body" %>
                    </div>

                    <%= link_to episode_path(anime_id: slot_entity.anime.database_id, episode_id: slot_entity.episode.database_id), class: "u-text-body" do %>
                      <span class="pr-1">
                        <%= slot_entity.episode.number %>
                      </span>

                      <%= slot_entity.episode.local_title %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
