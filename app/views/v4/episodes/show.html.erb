<% title = t "head.title.episodes.show", work_title: @episode_entity.anime.local_title, episode_title_with_number: @episode_entity.title_with_number %>
<% description = meta_description(t("head.meta.description.episodes.show", work_title: @episode_entity.anime.local_title, episode_title_with_number: @episode_entity.title_with_number)) %>
<% image_url = @episode_entity.anime.image_url_1x %>
<% set_meta_tags(title: title, description: description, og: { description: description, image: image_url }, twitter: { description: description, image: image_url }, reverse: true, prefix: false) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 pr-md-0 py-3">
      <%= render Sidebars::AnimeSidebarComponent.new(anime_entity: @episode_entity.anime, vod_channel_entities: @existing_vod_channel_entities, viewer: current_user) %>
    </div>

    <div class="col-md-9">
      <div class="mb-3">
        <%= render WorkSubNavComponent.new(work_entity: @episode_entity.anime, page_category: page_category) %>
      </div>

      <div class="align-items-center mb-1 row">
        <div class="col">
          <h2 class="mb-0">
            <%= link_to @episode_entity.title_with_number, episode_path(@episode_entity.anime.database_id, @episode_entity.database_id), class: "u-text-body" %>
          </h2>
        </div>
        <div class="col-auto pl-0">
          <%= render ButtonGroups::EpisodeTransitionButtonGroupComponent.new(episode_entity: @episode_entity) %>
        </div>
      </div>

      <ul class="list-inline mb-3">
        <li class="list-inline-item">
          <span class="font-weight-bold h4">
            <%= @episode_entity.episode_records_count %>
          </span>
          <span class="small text-muted">
            <%= t "noun.records_count" %>
          </span>
        </li>
        <li class="list-inline-item">
          <span class="font-weight-bold h4">
            <%= @episode_entity.commented_episode_records_count %>
          </span>
          <span class="small text-muted">
            <%= t "noun.comments_count" %>
          </span>
        </li>
      </ul>

      <div class="mb-3">
        <%= render Forms::EpisodeRecordFormComponent.new(form: @form, user: current_user) %>
      </div>

      <div class="mb-3">
        <h3 class="font-weight-bold">
          <%= t "noun.my_records" %>
        </h3>

        <% if @my_record_entities.present? %>
          <% @my_record_entities.each do |record_entity| %>
            <div class="py-3 u-underline">
              <div class="mb-3">
                <%= render RecordHeaderComponent.new(user_entity: record_entity.user, record_entity: record_entity) %>
              </div>

              <%= render EpisodeRecordContentComponent.new(
                user_entity: record_entity.user,
                work_entity: record_entity.trackable.anime,
                episode_entity: record_entity.trackable,
                record_entity: record_entity,
                episode_record_entity: record_entity.complementable,
                show_card: false
              ) %>
            </div>
          <% end %>
        <% else %>
          <%= render EmptyComponent.new(text: t("messages._empty.no_records")) %>
        <% end %>
      </div>

      <h3 class="font-weight-bold mb-3">
        <%= t "noun.following_records" %>
      </h3>
    </div>
  </div>
</div>
