<% title = t "head.title.episodes.show", work_title: @anime.local_title, episode_title_with_number: @episode.title_with_number %>
<% description = meta_description(t("head.meta.description.episodes.show", work_title: @anime.local_title, episode_title_with_number: @episode.title_with_number)) %>
<% image_url = ann_image_url(@anime.work_image, :image, size: "640x", ratio: "3:4") %>
<% set_meta_tags(title: title, description: description, og: { description: description, image: image_url }, twitter: { description: description, image: image_url }, reverse: true, prefix: false) %>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 pr-md-0 py-3">
      <%= render Sidebars::AnimeSidebarComponent2.new(anime: @anime, vod_channels: @vod_channels) %>
    </div>

    <div class="col-md-9">
      <div class="mb-3">
        <%= render AnimeSubNavComponent.new(anime: @anime, page_category: page_category) %>
      </div>

      <div class="align-items-center mb-1 row">
        <div class="col">
          <h2 class="mb-0">
            <%= link_to @episode.title_with_number, episode_path(@anime.id, @episode.id), class: "u-text-body" %>
          </h2>
        </div>
        <div class="col-auto pl-0">
          <%= render ButtonGroups::EpisodeTransitionButtonGroupComponent2.new(episode: @episode) %>
        </div>
      </div>

      <ul class="list-inline mb-3">
        <li class="list-inline-item">
          <span class="font-weight-bold h4">
            <%= @episode.episode_records_count %>
          </span>
          <span class="small text-muted">
            <%= t "noun.records_count" %>
          </span>
        </li>
        <li class="list-inline-item">
          <span class="font-weight-bold h4">
            <%= @episode.commented_episode_records_count %>
          </span>
          <span class="small text-muted">
            <%= t "noun.comments_count" %>
          </span>
        </li>
      </ul>

      <div class="mb-5">
        <turbo-frame id="episode-record-form" src="<%= my_episode_record_form_path(@episode.id) %>" target="_top"></turbo-frame>
      </div>

      <hr class="mb-5">

      <turbo-frame
        autoscroll="start"
        data-controller="reloadable-frame"
        data-reloadable-frame-event-name-value="my-episode-record-list"
        data-reloadable-frame-target="frame"
        id="my-episode-record-list"
        src="<%= my_episode_record_list_path(@episode.id, page: params[:page]) %>"
      >
        <div class="mb-3">
          <h3 class="font-weight-bold mb-3">
            <%= t "noun.my_records" %>
          </h3>

          <div class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </div>

        <hr class="mb-5">

        <div class="mb-3">
          <h3 class="font-weight-bold mb-3">
            <%= t "noun.following_records" %>
          </h3>

          <div class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </div>

        <hr class="mb-5">

        <div class="mb-3">
          <h3 class="font-weight-bold mb-3">
            <%= t "noun.other_comments" %>
          </h3>

          <%= render Lists::RecordListComponent2.new(records: @public_records, show_card: false) %>
        </div>
      </turbo-frame>
    </div>
  </div>
</div>
