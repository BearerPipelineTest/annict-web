<turbo-frame id="c-tracking-modal-frame">
  <%= component_value_fetcher_tag("status-select-dropdown", internal_api_library_entry_list_path(anime_ids: [@anime.id])) %>

  <div class="modal-body">
    <div class="gx-3 row">
      <div class="col-auto">
        <%= link_to anime_path(@anime.id) do %>
          <%= Pictures::AnimePictureComponent.new(self, anime: @anime, width: 100).render %>
        <% end %>

        <div class="mt-2 text-center">
          <%= ButtonGroups::AnimeButtonGroupComponent.new(self, anime: @anime, show_option_button: false).render %>
        </div>
      </div>

      <div class="col">
        <h3 class="fw-bold mb-0">
          <%= @anime.local_title %>
        </h3>

        <ul class="list-inline mt-2 small">
          <li class="list-inline-item">
            <%= link_to anime_path(@anime.id), data: { "turbo-frame": "_top" } do %>
              <%= t("noun.work_detail_page") %>
              <i class="far fa-angle-right ms-1"></i>
            <% end %>
          </li>
        </ul>
      </div>

      <div class="col-auto">
        <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
      </div>
    </div>

    <div class="mt-5">
      <h4 class="fw-bold">
        <%= t "noun.programs" %>
      </h4>

      <div>
        <% if @programs.present? %>
          <%= Radios::ProgramSelectRadioComponent.new(self, library_entry: @library_entry, programs: @programs).render %>
        <% else %>
          <%= t "messages._empty.no_programs" %>
        <% end %>
      </div>
    </div>

    <div class="mt-5">
      <h4 class="fw-bold">
        <%= t "noun.untracked_episodes" %>
      </h4>

      <div class="card">
        <ul class="c-tracking-episode-list-group list-group list-group-flush">
          <% @episodes.each do |episode| %>
            <li class="list-group-item" data-episode-id="<%= episode.id %>">
              <div class="align-items-center row">
                <div class="col-auto pe-0">
                  <%= Buttons::WatchEpisodeButtonComponent.new(
                    self, episode_id: episode.id, class_name: "btn-sm btn-outline-info rounded-circle"
                  ).render %>
                </div>

                <div class="col-auto ps-2 px-0">
                  <%= Buttons::BulkWatchEpisodesButtonComponent.new(
                    self, episode_id: episode.id, class_name: "btn-sm btn-outline-info rounded-circle"
                  ).render %>
                </div>

                <div class="col-auto ps-2 pe-0">
                  <%= Buttons::SkipEpisodeButtonComponent.new(
                    self, episode_id: episode.id, class_name: "btn-sm btn-outline-secondary rounded-circle"
                  ).render %>
                </div>

                <div class="c-tracking-state__title col">
                  <%= link_to fragment_trackable_episode_path(episode.id), class: "text-body" do %>
                    <%= episode.title_with_number %>
                  <% end %>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      </div>

      <div class="mt-3 text-center">
        <%= ButtonGroups::PaginationButtonGroupComponent.new(self, collection: @episodes).render %>
      </div>
    </div>
  </div>
</turbo-frame>
